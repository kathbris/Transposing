<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Formula Transposition Practice</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
    }
    .toolbox, .workspace, .trash {
      border: 2px dashed #ccc;
      padding: 10px;
      min-height: 60px;
      margin-bottom: 20px;
    }
    .draggable {
      display: inline-block;
      padding: 8px 12px;
      margin: 5px;
      background-color: #f0f0f0;
      border: 1px solid #999;
      cursor: move;
    }
    .workspace {
      background-color: #fafafa;
    }
    .trash {
      background-color: #ffe6e6;
      border-color: #ff9999;
      color: #cc0000;
    }
    #formulaDisplay {
      font-weight: bold;
      margin-bottom: 10px;
    }
    #preview {
      font-size: 1.2em;
      margin-top: 10px;
      padding: 10px;
      background-color: #eef;
      border: 1px solid #99c;
    }
    button {
      padding: 8px 12px;
      margin-top: 10px;
    }
    #steps {
      margin-top: 10px;
      padding: 10px;
      background-color: #f9f9f9;
      border-left: 4px solid #00A3E0;
    }
  </style>

  <!-- ‚úÖ Correct MathJax v3 script -->
  <script>
window.MathJax = {
  tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
  svg: { fontCache: 'global' }
};
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
  <h1>Formula Transposition Practice</h1>
  <div id="formulaDisplay">
    Original Formula: <span id="originalFormula"></span><br>
    Solve for: <span id="solveFor"></span>
  </div>

  <div class="toolbox" id="toolbox">
    <strong>Toolbox:</strong><br>
  </div>

  <div class="workspace" id="workspace" ondrop="drop(event)" ondragover="allowDrop(event)">
    <strong>Drag items here to build your formula:</strong>
  </div>

  <div class="trash" id="trash" ondrop="deleteItem(event)" ondragover="allowDrop(event)">
    <strong>üóëÔ∏è Drag here to delete items from workspace</strong>
  </div>

  <div id="preview"><strong>Live Preview:</strong> <span id="mathPreview"></span></div>

  <button onclick="checkVisualAnswer()">Check Answer</button>
  <button onclick="generateVisualFormula()">New Formula</button>
  <p id="feedback"></p>
  <div id="steps"></div>

  <script>
    const formulas = [ 
      {
        expression: "A = B + C ‚àí D",
        solve: "C",
        solution: "C=A‚àíB+D",
        solution2: "C=A+D‚àíB",
        items: ["A", "B", "C", "D", "+", "‚àí", "=", "(", ")"],
        steps: [
          "Start with the formula: $$ A = B + C ‚àí D $$",
          "Add $D$ to both sides: $$ A + D = B + C $$",
          "Subtract $B$ from both sides: $$ A + D ‚àí B = C $$",
          "Rearranged: $$ C = A ‚àí B + D $$"
        ]
      },
      {
        expression: "A = B + C ‚àí D",
        solve: "B",
        solution: "B=A‚àíC+D",
        solution2: "B=A+D‚àíC",
        items: ["A", "B", "C", "D", "+", "‚àí", "=", "(", ")"],
        steps: [
          "Start with the formula: $$ A = B + C ‚àí D $$",
          "Subtract $C$ from both sides: $$ A ‚àí C = B + D $$",
          "Add $D$ to both sides: $$ A + D ‚àí C = B $$",
          "Rearranged: $$ B = A + D ‚àí C $$"
        ]
      },
      {
        expression: "A = B + C ‚àí D",
        solve: "D",
        solution: "D=B+C‚àíA",
        solution2: "",
        items: ["A", "B", "C", "D", "+", "‚àí", "=", "(", ")"],
        steps: [
          "Start with the formula: $$ A = B + C ‚àí D $$",
          "Add $D$ to both sides: $$ A + D = B + C $$",
          "Subtract $A$ from both sides: $$ D = B + C ‚àí A $$",
        ]
      },
      {
        expression: "V = l ‚àó w ‚àó h",
        solve: "h",
        solution: "h=V/(l‚àów)",
        solution2:"h=V/(w‚àól)",
        items: ["V", "l", "w", "h", "‚àó", "/", "=", "(", ")"],
        steps: [
          "Start with the formula: $$ V = l ‚àó w ‚àó h $$",
          "Divide both sides by $l ‚àó w$ : $$ \\frac {V}{l ‚àó w} = h $$",
          "Rearranged: $$ h = \\frac {V}{l ‚àó w} $$"
        ]
      },
            {
        expression: "V = l ‚àó w ‚àó h",
        solve: "w",
        solution: "h=V/(l‚àów)",
        solution2:"h=V/(w‚àól)",
        items: ["V", "l", "w", "h", "‚àó", "/", "=", "(", ")"],
        steps: [
          "Start with the formula: $$ V = l ‚àó w ‚àó h $$",
          "Divide both sides by $l ‚àó h$ : $$ \\frac {V}{l ‚àó h} = w $$",
          "Rearranged: $$ w = \\frac {V}{l ‚àó h} $$"
        ]
      },
            {
        expression: "V = l ‚àó w ‚àó h",
        solve: "l",
        solution: "l=V/(w‚àóh)",
        solution2:"l=V/(h‚àów)",
        items: ["V", "l", "w", "h", "‚àó", "/", "=", "(", ")"],
        steps: [
          "Start with the formula: $$ V = l ‚àó w ‚àó h $$",
          "Divide both sides by $w ‚àó h$ : $$ \\frac {V}{w ‚àó h} = l $$",
          "Rearranged: $$ l = \\frac {V}{w ‚àó h} $$"
        ]
      },
      {
        expression: "F = m ‚àó a",
        solve: "m",
        solution: "m=F/a",
        solution2:"",
        items: ["F", "m", "a", "‚àó", "/", "=", "(", ")"],
        steps: [
          "Start with the formula: $$ F = m ‚àó a $$",
          "Divide both sides by $a$: $$ \\frac Fa = m $$",
          "Rearranged: $$ m = \\frac Fa $$"
        ]
      },
      {
        expression: "P = V^2 / R",
        solve: "R",
        solution: "R=V^2/P",
        solution2:"",
        items: ["P", "V", "R", "^2", "/","‚àó","‚àö", "=", "(", ")"],
        steps: [
          "Start with the formula: $$ P = \\frac {V^2}{R} $$",
          "Multiply both sides by $R$: $$ P ‚àó R = V^2 $$",
          "Divide both sides by $P$: $$ R = \\frac {V^2}{P} $$"
        ]
      },{
        expression: "P = V^2 / R",
        solve: "V",
        solution: "V=‚àö(P‚àóR)",
        solution2:"V=‚àö(R‚àóP)",
        items: ["P", "V", "R", "^2", "/","‚àó","‚àö", "=", "(", ")"],
        steps: [
          "Start with the formula: $$ P = \\frac {V^2}{R} $$",
          "Multiply both sides by $R$: $$ P ‚àó R = V^2 $$",
          "Divide both sides by $P$: $$ R = \\frac {V^2}{P} $$"
        ]
      },
      {
        expression: "Q = m ‚àó c ‚àó ŒîT",
        solve: "ŒîT",
        solution: "ŒîT=Q/(m‚àóc)",
        solution2:"",
        items: ["Q", "m", "c", "ŒîT", "‚àó", "/", "=", "(", ")"],
        steps: [
          "Start with the formula: $$ Q = m ‚àó c ‚àó ŒîT $$",
          "Divide both sides by $m ‚àó c$:  $$\\frac {Q}{m ‚àó c} = ŒîT $$",
          "Rearranged: $$ ŒîT = \\frac {Q}{m ‚àó c} $$"
        ]
      },
      {
        expression: "I = E / R",
        solve: "R",
        solution: "R=E/I",
        solution2:"",
        items: ["E", "I", "R", "‚àó", "/", "=", "(", ")"],
        steps: [
          "Start with the formula: $$ I = \\frac EI $$",
          "Multiply both sides by $R$ : $$ I ‚àó R = E $$",
          "Divide both sides by $I$ : $$ R = //frac EI $$"
        ]
      },      {
        expression: "I = E / R",
        solve: "E",
        solution: "E=I‚àóR",
        solution2:"E=R‚àóI",
        items: ["E", "I", "R", "‚àó", "/", "=", "(", ")"],
        steps: [
          "Start with the formula: $$ I = \\frac EI $$",
          "Multiply both sides by $R$ : $$ I ‚àó R = E $$",
          "Rearranged : $$ E = I ‚àó R $$"
        ]
      },
      {
        expression: "P = I ‚àó V",
        solve: "I",
        solution: "I=\\frac PV",
        solution2:"",
        items: ["P", "I", "V", "‚àó", "/", "=", "(", ")"],
        steps: [
          "Start with the formula: $$ P = I ‚àó V $$",
          "Divide both sides by V: $$ \\frac PV = I $$",
          "Rearranged: $$ I = \\frac PV $$"
        ]
      },
      {
        expression: "c^2 = a^2 + b^2",
        solve: "b",
        solution: "b=‚àö(c^2‚àía^2)",
        solution2:"",
        items: ["a", "b", "c","^2", "+", "‚àí", "=", "‚àö", "(", ")"],
        steps: [
          "Start with the formula: $$ c^2 = a^2 + b^2 $$",
          "Subtract $ a^2 $ from both sides: $$ c^2 ‚àí a^2 = b^2 $$",
          "Take the square root of both sides: $$ b = \\sqrt{c^2 ‚àí a^2} $$"
        ]
      }
    ];

    let currentFormula = {};
    let draggedElement = null;

    function allowDrop(ev) {
      ev.preventDefault();
    }

    function drag(ev) {
      draggedElement = ev.target;
      ev.dataTransfer.setData("text/plain", "");
    }

    function drop(ev) {
      ev.preventDefault();
      if (draggedElement && draggedElement.parentElement.id === "toolbox") {
        const clone = draggedElement.cloneNode(true);
        clone.draggable = true;
        clone.className = "draggable";
        clone.ondragstart = drag;
        // Always append to the workspace container, not the drop target
        document.getElementById("workspace").appendChild(clone);
        updatePreview();
      }
    }

    function deleteItem(ev) {
      ev.preventDefault();
      if (draggedElement && draggedElement.parentElement.id === "workspace") {
        draggedElement.remove();
        updatePreview();
      }
    }

    function generateVisualFormula() {
      const randomIndex = Math.floor(Math.random() * formulas.length);
      currentFormula = formulas[randomIndex];

      document.getElementById("originalFormula").innerHTML = `$ ${currentFormula.expression} $`;
      document.getElementById("solveFor").textContent = `$ ${currentFormula.solve} $`;
      MathJax.typeset();

      const workspace = document.getElementById("workspace");
      workspace.innerHTML = "<strong>Drag items here to build your formula:</strong>";

      const preloadItems = [currentFormula.solve, "="];
      preloadItems.forEach(item => {
        const el = document.createElement("div");
        el.textContent = item;
        el.className = "draggable";
        el.draggable = true;
        el.ondragstart = drag;
        workspace.appendChild(el);
      });

      const toolbox = document.getElementById("toolbox");
      toolbox.innerHTML = "<strong>Toolbox:</strong><br>";

      //const allItems = [...currentFormula.items];
      const allItems = currentFormula.items.map(eq=> `$${eq}$`);
      allItems.forEach(item => {
        const el = document.createElement("div");
        el.textContent = item;
        el.className = "draggable";
        el.draggable = true;
        el.ondragstart = drag;
        toolbox.appendChild(el);
      });

      updatePreview();
      document.getElementById("feedback").textContent = "";
      document.getElementById("steps").innerHTML = "";
    }

    function updatePreview() {
      const workspaceItems =Array.from(document.getElementById("workspace").children)
        .filter(el => el.classList.contains("draggable"))
        .map(el => el.textContent);
console.log(workspaceItems);
      let latex = "";
      for (let i = 0; i < workspaceItems.length; i++) {
        const item = workspaceItems[i];
        const next = workspaceItems[i + 1] || "";
        console.log(item,i);
      if (item.includes("2")) {
        //const removed = latex.slice(0,latex.lenght -1);
        latex += "^2"
      } else if (item === "‚àö") {
        if (next) {
          latex += `\\sqrt{${next}}`;
          i++;
        } else {
          latex += `\\sqrt{}`;
        }
      } else if (item === "‚àó") {
        latex += "‚àó";
      } else if (item === "/") {
        latex += "/";
      } else if (item === "=") {
        latex += "=";
      } else if (item === "(" || item === ")") {
        latex += item;
      } else {
        latex += item;
      }
    //console.log(latex,item);  
    }
      
      document.getElementById("mathPreview").innerHTML = `$$ ${latex} $$`;
      MathJax.typeset();
    }

    function checkVisualAnswer() {
      var workspaceItems = Array.from(document.getElementById("workspace").children)
        .filter(el => el.classList.contains("draggable"))
        .map(el => el.textContent)
        .join('');
      var workspaceItems = workspaceItems.replace(/2/g,"^2");
      console.log(currentFormula.solution,workspaceItems);
      const correct = currentFormula.solution.replace(/\s+/g, '');
      const correct2 = currentFormula.solution2.replace(/\s+/g, '');
      console.log(correct,workspaceItems);
      if (workspaceItems == correct || workspaceItems == correct2 ) {
        document.getElementById("feedback").textContent = "‚úÖ Correct!";
        document.getElementById("feedback").style.color = "green";
        document.getElementById("steps").innerHTML = "";
      } else {
        document.getElementById("feedback").innerHTML = `‚ùå Incorrect. Correct answer: $$ ${currentFormula.solution} $$`;
        document.getElementById("feedback").style.color = "red";
        const stepsHtml = currentFormula.steps.map(step => `<div>${step}</div>`).join('');
        document.getElementById("steps").innerHTML = `<strong>Steps to solve:</strong><br>${stepsHtml}`;
        MathJax.typeset();
      }
    }

    generateVisualFormula();
  </script>
</body>
</html>
